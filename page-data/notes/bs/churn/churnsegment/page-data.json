{"componentChunkName":"component---src-templates-entry-js","path":"/notes/bs/churn/churnsegment","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Segmentation with Churn"},"html":"<h3>Defining Metric Cohort Analysis</h3>\n<ul>\n<li>There are many different methods for analyzing customer cohorts for churn</li>\n<li>Generally, we should create cohorts for customers who we think have different churn rates</li>\n<li>The most basic method involves considering people who often use a product as less likely to churn</li>\n<li>As an example, suppose active customers churn less often compared to inactive customers</li>\n<li>Then, a group of active customers should have a lower churn rate than a group of inactive customers</li>\n<li>As a result, we should create cohorts based on a customer's level of activity</li>\n</ul>\n<h3>Illustrating Steps for Cohort Analysis</h3>\n<ol>\n<li>\n<p>Read in data including the following columns:</p>\n<ul>\n<li>Customer ID</li>\n<li>Binary churn column</li>\n<li>Date</li>\n<li>Cohort column (e.g. number of clicks)</li>\n</ul>\n</li>\n<li>\n<p>Segment cohorts by cohort column</p>\n<ul>\n<li>Usually, we group customers into cohorts so each cohort contains 10% of the total sum of the cohort column</li>\n<li>E.g. each customer is assigned to a cohort where each cohort contains 10% of the total number of clicks</li>\n</ul>\n</li>\n<li>Calculate averages of cohort column for each cohort (or segment)</li>\n<li>Plot the churn rates versus the corresponding average of the cohort column for each cohort</li>\n</ol>\n<h3>Illustrating Code for Cohort Analysis</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Step 1: Read in data</span>\ndf <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'data.csv'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Step 2: Group customers into cohorts</span>\ngroups <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>qcut<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">[</span><span class=\"token string\">'cohort_column'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Step 3: Calculate averages for plot</span>\nmeans <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>groupby<span class=\"token punctuation\">(</span>groups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'cohort_column'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nchurns <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>groupby<span class=\"token punctuation\">(</span>groups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'is_churn'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Step 4: Plot churn rates vs averages</span>\nplt <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">:</span> means<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> churns<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Summarizing Customer Behavior</h3>\n<ul>\n<li>\n<p>Typically, we'll need to impute missing values and aggregate non-zero values for each column</p>\n<ul>\n<li>We may also want to remove columns with 90% missing values</li>\n</ul>\n</li>\n<li>\n<p>We can do this by calling the <code class=\"language-text\">DataFrame.describe</code> function in pandas</p>\n<ul>\n<li>We can determine if columns are skewed by calling <code class=\"language-text\">DataFrame.skew</code></li>\n</ul>\n</li>\n<li>This will help in profiling and understandomg the distributions of each column</li>\n<li>\n<p>In other words, we'll need to run quick profiles including the following aggregates for each column:</p>\n<ul>\n<li>Counts</li>\n<li>Null values</li>\n<li>Non-zero values</li>\n<li>Skewness of columns</li>\n<li>Means</li>\n<li>Standard deviation</li>\n<li>Minimum values</li>\n<li>Maximum values</li>\n</ul>\n</li>\n</ul>\n<h3>Scoring Metrics for Segmentation</h3>\n<ul>\n<li>Typically, we'll want to standardize each column before clustering</li>\n<li>\n<p>In particular, we'll use a standard scaling formula</p>\n<ul>\n<li>To do this, we can call the <code class=\"language-text\">sklearn.preprocessing.StandardScaler</code> function</li>\n</ul>\n</li>\n<li>However, some columns may be extremely skewed</li>\n<li>In order to reduce the skewness of a column, we can first transform those skewed columns</li>\n<li>Specifially, we'll take the logarithm of the column</li>\n<li>\n<p>The following steps are done for skewed columns:</p>\n<ol>\n<li>Gather feature <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></li>\n<li>Take the log of feature <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></li>\n</ol>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>X</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>X</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">X&#x27; = \\log(X + 1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.801892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span>\n<ol start=\"3\">\n<li>Standardize features by removing the mean and scaling to unit variance</li>\n</ol>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>Z</mi><mo>=</mo><mfrac><mrow><msup><mi>X</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>−</mo><msub><mi>μ</mi><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></msub></mrow><msub><mi>σ</mi><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></msub></mfrac></mrow><annotation encoding=\"application/x-tex\">Z = \\frac{X&#x27; - \\mu_{x&#x27;}}{\\sigma_{x&#x27;}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.2648919999999997em;vertical-align:-0.8360000000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4288919999999998em;\"><span style=\"top:-2.3139999999999996em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32797999999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828285714285715em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">μ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32797999999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828285714285715em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8360000000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n</li>\n<li>Taking the log will result in more evenly distributed standardized features</li>\n<li>We can skip step 2 for unskewed features</li>\n</ul>\n<h3>Segmenting Customers by using Cohort Analysis</h3>\n<ul>\n<li>Cohorts should be created for customers with different churn rates</li>\n<li>\n<p>The following features are some of the most common features used for separating segments:</p>\n<ul>\n<li>Shopping frequency</li>\n<li>Engagement frequency</li>\n<li>Seasonality</li>\n<li>Purchases or engagement around promotional events</li>\n</ul>\n</li>\n<li>\n<p>As a result, each segment should have a different churn rate</p>\n<ul>\n<li>\n<p>Because, assigning a segment with an arbitrary or fixed churn rate (used across all segments) may either:</p>\n<ul>\n<li>Inaccurately label certain customers as churned</li>\n<li>Or may miss certain churned customers </li>\n</ul>\n</li>\n<li>\n<p>For example, suppose a segment contains customers consistently purchasing during a yearly promo</p>\n<ul>\n<li>\n<p>If we naively define a churn window of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> year, we may mistakenly treat this customer as churned</p>\n<ul>\n<li>By having a better understanding of this customer, we can apply a more specialized targeting strategy for this segment of customers (e.g. increasing frequency promos)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>However, if we naively increase the churn window to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span> years for all customers, then we may mistakenly label certain customers as non-churned when they actually have churned</p>\n<ul>\n<li>E.g. if a customer who frequently purchases every week stops purchasing all of a sudden, we wouldn't label this customer as churned for another year or so</li>\n<li>This would be a big mistake, since this segment of customers would be most likely high value customers</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Then, we can assign different targeting strategies for each segment</li>\n<li>\n<p>Each targeting strategy should achieve any of the following goals:</p>\n<ol>\n<li>Improving shopping (or engagement) frequency</li>\n<li>Improving size of orders</li>\n<li>Reducing churn rate</li>\n</ol>\n</li>\n</ul>\n<h3>Describing Clustering Methods</h3>\n<ul>\n<li>Essentially, clustering methods group customers based on features that're correlated with each other</li>\n<li>\n<p>Roughly, there are <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span> popular clustering methods:</p>\n<ul>\n<li>Agglomerative</li>\n<li>Density-based</li>\n<li>Centroid-based</li>\n</ul>\n</li>\n<li>\n<p>Agglomerative clustering combines similar customers in a bottom-up manner</p>\n<ul>\n<li>First, groups are formed starting from just two similar customers</li>\n<li>More elements are added to form larger groups of similar items as the algorithm advances</li>\n</ul>\n</li>\n<li>Density-based clustering combines similar customers that are close to each other</li>\n<li>Centroid-based clustering combines similar customers together who are closest to a centroid</li>\n</ul>\n<h3>Standardizing Features with Ratios</h3>\n<ul>\n<li>Typically, we'll want to transform features before clustering as ratios</li>\n<li>\n<p>For example, we may not only want to include a <em>number of email opens</em> feature for clustering</p>\n<ul>\n<li>This is because certain customers might be sent more emails than others</li>\n</ul>\n</li>\n<li>In this case, we may want to only cluster on a feature repesenting a ratio of <em>number of email opens</em> relative to <em>number of email sends</em></li>\n<li>Also, we may want to create a ratio of <em>number of email opens</em> relative to the <em>spend</em> for each customer</li>\n</ul>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://fightchurnwithdata.com/\" target=\"_blank\" rel=\"nofollow\">Textbook for Fighting Churn with Data</a></li>\n<li><a href=\"https://algorithmicweb.files.wordpress.com/2018/07/algorithmic-marketing-ai-for-marketing-operations-r1-7g.pdf\" target=\"_blank\" rel=\"nofollow\">Textbook about Algorithmic Marketing</a></li>\n<li><a href=\"https://github.com/square/pysurvival/blob/master/notebooks/Employee%20retention%20-%20Knowing%20when%20your%20employees%20will%20quit.ipynb\" target=\"_blank\" rel=\"nofollow\">Analysis about Time-to-Churn using pysurvival</a></li>\n<li><a href=\"https://www.datacamp.com/courses/marketing-analytics-predicting-customer-churn-in-python\" target=\"_blank\" rel=\"nofollow\">Course about Predicting Customer Churn</a></li>\n<li><a href=\"https://www.datacamp.com/courses/machine-learning-for-marketing-in-python\" target=\"_blank\" rel=\"nofollow\">Course about Customer Churn</a></li>\n</ul>"}},"pageContext":{"slug":"bs/churn/churnsegment","previousSlug":"bs/churn/churnobserve","nextSlug":"bs/churn/ltv","previousTitle":"Observing Churn","nextTitle":"Customer Lifetime Value"}},"staticQueryHashes":[]}