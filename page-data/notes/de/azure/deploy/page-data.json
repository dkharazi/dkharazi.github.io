{"componentChunkName":"component---src-templates-entry-js","path":"/notes/de/azure/deploy","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Azure Model Deployment"},"html":"<h3>Defining a Machine Learning Workflow</h3>\n<ol>\n<li>\n<p>Deploy a model</p>\n<ul>\n<li>We can use AzureML or Databricks to achieve this</li>\n</ul>\n</li>\n<li>\n<p>Build a pipeline</p>\n<ul>\n<li>Pipelines are used to automate model deploying in the future</li>\n<li>We will typically want to automatically tune the model</li>\n<li>\n<p>We can build a pipeline to avoid repeating these steps:</p>\n<ol>\n<li>Preparing more data</li>\n<li>Validating the data</li>\n<li>Deploying the model manually</li>\n</ol>\n</li>\n<li>We would use the AzureML or Azure Devops to achieve this</li>\n</ul>\n</li>\n</ol>\n<h3>Example of Model Deployment in Azure</h3>\n<ol>\n<li>Create a workspace in the Azure Machine Learning service</li>\n<li>\n<p>Create a model using regular Python code in any IDE</p>\n<ul>\n<li>This could include creating a model using sklearn, tensorflow, etc.</li>\n<li>We would want to save this model using pickle</li>\n</ul>\n</li>\n<li>Initialize the workspace using the Python SDK in an IDE</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core <span class=\"token keyword\">import</span> Workspace\nws <span class=\"token operator\">=</span> Workspace<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>\n\tname<span class=\"token operator\">=</span><span class=\"token string\">'myworkspace'</span><span class=\"token punctuation\">,</span>\n\tsubscription_id<span class=\"token operator\">=</span><span class=\"token string\">'&lt;azure-subscription-id>'</span><span class=\"token punctuation\">,</span>\n\tresource_group<span class=\"token operator\">=</span><span class=\"token string\">'myresourcegroup'</span><span class=\"token punctuation\">,</span>\n\tcreate_resource_group<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n\tlocation<span class=\"token operator\">=</span><span class=\"token string\">'eastus2'</span>\n\t<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"4\">\n<li>\n<p>Register input data and output data using the Python SDK in an IDE</p>\n<ul>\n<li>We want to record the data used to create this model in our workspace</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core <span class=\"token keyword\">import</span> Dataset\ndatastore <span class=\"token operator\">=</span> ws<span class=\"token punctuation\">.</span>get_default_datastore<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ndatastore<span class=\"token punctuation\">.</span>upload_files<span class=\"token punctuation\">(</span>\n\tfiles<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'./features.csv'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./labels.csv'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\ttarget_path<span class=\"token operator\">=</span><span class=\"token string\">'sklearn_regression/'</span><span class=\"token punctuation\">,</span>\n\toverwrite<span class=\"token operator\">=</span><span class=\"token boolean\">True</span>\n\t<span class=\"token punctuation\">)</span>\ninput_dataset <span class=\"token operator\">=</span> Dataset<span class=\"token punctuation\">.</span>Tabular<span class=\"token punctuation\">.</span>from_delimited_files<span class=\"token punctuation\">(</span>path<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>datastore<span class=\"token punctuation\">,</span> <span class=\"token string\">'sklearn_regression/features.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\noutput_dataset <span class=\"token operator\">=</span> Dataset<span class=\"token punctuation\">.</span>Tabular<span class=\"token punctuation\">.</span>from_delimited_files<span class=\"token punctuation\">(</span>path<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>datastore<span class=\"token punctuation\">,</span> <span class=\"token string\">'sklearn_regression/labels.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"5\">\n<li>\n<p>Register our model using the Python SDK in an IDE</p>\n<ul>\n<li>We want to record model metadata in our workspace</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core <span class=\"token keyword\">import</span> Model\n<span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>resource_configuration <span class=\"token keyword\">import</span> ResourceConfiguration\nmodel <span class=\"token operator\">=</span> Model<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span>\n\tworkspace<span class=\"token operator\">=</span>ws<span class=\"token punctuation\">,</span>\n\tmodel_name<span class=\"token operator\">=</span><span class=\"token string\">'my-sklearn-model'</span><span class=\"token punctuation\">,</span>\n\tmodel_path<span class=\"token operator\">=</span><span class=\"token string\">'./sklearn_regression_model.pkl'</span><span class=\"token punctuation\">,</span>\n\tmodel_framework<span class=\"token operator\">=</span>Model<span class=\"token punctuation\">.</span>Framework<span class=\"token punctuation\">.</span>SCIKITLEARN<span class=\"token punctuation\">,</span>\n\tmodel_framework_version<span class=\"token operator\">=</span><span class=\"token string\">'0.19.1'</span><span class=\"token punctuation\">,</span>\n\tsample_input_dataset<span class=\"token operator\">=</span>input_dataset<span class=\"token punctuation\">,</span>\n\tsample_output_dataset<span class=\"token operator\">=</span>output_dataset<span class=\"token punctuation\">,</span>\n\tresource_configuration<span class=\"token operator\">=</span>ResourceConfiguration<span class=\"token punctuation\">(</span>cpu<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> memory_in_gb<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\tdescription<span class=\"token operator\">=</span><span class=\"token string\">'Ridge regression model to predict diabetes progression.'</span><span class=\"token punctuation\">,</span>\n\ttags<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'area'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'diabetes'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'regression'</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"6\">\n<li>\n<p>Deploy our model using the Python SDK in an IDE</p>\n<ul>\n<li>Our model is deployed as a containerized web app (or web service)</li>\n<li>In other words, Azure deploys our model by building an image (from the model) and running containers based on that image</li>\n<li>\n<p>For a deployed web service, we can choose from the following container instances:</p>\n<ul>\n<li>Azure Container Instance (ACI)</li>\n<li>FPGA</li>\n<li>Docker</li>\n</ul>\n</li>\n<li>If we wanted to run our web service locally (rather than running it on Azure ML service), then we would want to deploy our model to a local Docker container instead</li>\n<li>If we wanted to run a more production-ready web service on Azure ML, then we want to deploy our model to the Azure Kubernetes service instead</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core <span class=\"token keyword\">import</span> Webservice\nservice <span class=\"token operator\">=</span> Model<span class=\"token punctuation\">.</span>deploy<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">,</span> <span class=\"token string\">'my-sklearn-service'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>model<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"7\">\n<li>Run the deployed web service using the Python SDK in an IDE</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\ninput_payload <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token string\">'data'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">187</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">'method'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'predict'</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\noutput <span class=\"token operator\">=</span> service<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>input_payload<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Defining Runs and Experiments in Azure</h3>\n<ul>\n<li>\n<p>The <em>Run</em> class is in AzureML</p>\n<ul>\n<li>It refers to Python code for a specific task</li>\n<li>For example, training a model or tuning hyperparameters</li>\n</ul>\n</li>\n<li>\n<p>A run logs metrics and uploads the result to the Azure platform</p>\n<ul>\n<li>It's a more natural way to track jobs in a workspace</li>\n</ul>\n</li>\n<li>\n<p>The <em>Experiment</em> class is a term that refers to a composition of a series of runs</p>\n<ul>\n<li>For example, we could have one run for a logistic regression model</li>\n<li>Another run could be for a kNN model</li>\n<li>Together, these runs could make up an experiment</li>\n</ul>\n</li>\n<li>We create runs and experiments to easily monitor and review a model throughout its training, testing, or tuning process</li>\n<li>\n<p>We can observe details about runs or experiments in the AzureML</p>\n<ul>\n<li>By going to the workspace associated with the runs or experiments</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> azureml<span class=\"token punctuation\">.</span>core <span class=\"token keyword\">import</span> Experiment\n<span class=\"token comment\">#Create an experiment</span>\nexperiment <span class=\"token operator\">=</span> Experiment<span class=\"token punctuation\">(</span>workspace <span class=\"token operator\">=</span> ws<span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"my-first-experiment\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#Create a run</span>\nrun <span class=\"token operator\">=</span> experiment<span class=\"token punctuation\">.</span>start_logging<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrun<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">(</span><span class=\"token string\">\"trial\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nrun<span class=\"token punctuation\">.</span>complete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Other Model Deployment Options</h3>\n<ul>\n<li>We can deploy an image already created from a model</li>\n<li>In this case, we would use the <code class=\"language-text\">deploy_from_image</code> method from the Webservice class</li>\n<li>We could also use the deploy method from the Webservice class</li>\n<li>We can deploy a model already registered in the workspace</li>\n<li>In this case, we could use the <code class=\"language-text\">deploy_from_model</code> method from the Webservice class</li>\n<li>We could also use the deploy method from the Model class</li>\n<li>This method will create an image</li>\n</ul>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://docs.microsoft.com/en-us/learn/certifications/azure-data-scientist\" target=\"_blank\" rel=\"nofollow\">Azure Data Science Certification</a></li>\n<li><a href=\"https://github.com/Microsoft/MLOpsPython\" target=\"_blank\" rel=\"nofollow\">Defining MLOps with Python</a></li>\n<li><a href=\"https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/deploy-to-cloud/model-register-and-deploy.ipynb\" target=\"_blank\" rel=\"nofollow\">Describing Model Registrey and Deployment</a></li>\n<li><a href=\"https://docs.microsoft.com/en-us/azure/devops/pipelines/targets/azure-machine-learning?view=azure-devops&#x26;tabs=yaml\" target=\"_blank\" rel=\"nofollow\">Describing Pipelines in Azure</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=tXZMYB3ByKE&#x26;feature=emb_logo\" target=\"_blank\" rel=\"nofollow\">Describing Azure HDInsight</a></li>\n<li><a href=\"https://www.clearpeaks.com/cloud-analytics-on-azure-databricks-vs-hdinsight-vs-data-lake-analytics/\" target=\"_blank\" rel=\"nofollow\">Comparing Azure HDInsight and Databricks</a></li>\n</ul>"}},"pageContext":{"slug":"de/azure/deploy","previousSlug":"de/azure/workspace","nextSlug":"de/azure/automl","previousTitle":"Azure Workspaces","nextTitle":"Azure AutoML"}},"staticQueryHashes":[]}