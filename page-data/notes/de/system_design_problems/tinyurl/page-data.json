{"componentChunkName":"component---src-templates-entry-js","path":"/notes/de/system_design_problems/tinyurl","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Designing TinyURL"},"html":"<h3>Step 1: Requirement Clarification</h3>\n<ul>\n<li>\n<p>Why are we creating a URL shortener?</p>\n<ul>\n<li>URL shortening is used to create aliases that are shorter represetnations of longer, actual links</li>\n<li>URL shortening is used to minimize the length of links, analyze audiences by tracking links, and measure performance of ad campaigns</li>\n</ul>\n</li>\n<li>\n<p>What are the functional requirements?</p>\n<ul>\n<li>Our service should generate a shorter and unique alias for any given URL</li>\n<li>Our service should have the shortened URL redirect users to the original link</li>\n<li>Our service should allow users to customize their shortened link</li>\n<li>Our service should enforce shortened links to expire after a given timespan</li>\n</ul>\n</li>\n<li>\n<p>What are the non-functional requirements?</p>\n<ul>\n<li>Our service should be highly available</li>\n<li>Our service should ensure URL redirection happens in real-time</li>\n<li>Our service should not be guessable</li>\n</ul>\n</li>\n<li>\n<p>What are the extended requirements?</p>\n<ul>\n<li>Our service should provide analytics about usage of link redirects</li>\n<li>Our service should have a REST API granting access to third-party services or users</li>\n</ul>\n</li>\n</ul>\n<h3>Step 2: Capacity Estimation and Constraints</h3>\n<ul>\n<li>\n<p><strong>Traffic Estimations:</strong></p>\n<ol>\n<li>\n<p>Estimate expected traffic variables:</p>\n<ul>\n<li>Expected reads per month is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn></mrow><annotation encoding=\"application/x-tex\">50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span></span></span></span> billion</li>\n<li>Expected writes per month is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>500</mn></mrow><annotation encoding=\"application/x-tex\">500</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> million</li>\n</ul>\n</li>\n<li>\n<p>Do the following conversions:</p>\n<ul>\n<li>Reads per second is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>50</mn><mi>B</mi></mrow><mrow><mn>30</mn><mo>×</mo><mn>24</mn><mo>×</mo><mn>3600</mn></mrow></mfrac><mo>=</mo><mn>20</mn><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">\\frac{50B}{30 \\times 24 \\times 3600} = 20K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.275662em;vertical-align:-0.403331em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.872331em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">0</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">4</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">0</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">5</span><span class=\"mord mtight\">0</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.403331em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></li>\n<li>Writes per second is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>500</mn><mi>M</mi></mrow><mrow><mn>30</mn><mo>×</mo><mn>24</mn><mo>×</mo><mn>3600</mn></mrow></mfrac><mo>=</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">\\frac{500M}{30 \\times 24 \\times 3600} = 200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.275662em;vertical-align:-0.403331em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.872331em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">0</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">4</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">0</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">5</span><span class=\"mord mtight\">0</span><span class=\"mord mtight\">0</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.403331em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>Storage Estimations:</strong></p>\n<ol>\n<li>\n<p>Estimate expected storage variables:</p>\n<ul>\n<li>Expected number of years until writes are purged is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span> years</li>\n<li>Expected data size of one packet/write is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>500</mn></mrow><annotation encoding=\"application/x-tex\">500</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> bytes</li>\n<li>URLs can be stored in a RDBMS or MySQL database</li>\n</ul>\n</li>\n<li>\n<p>Do the following conversions:</p>\n<ul>\n<li>Total writes stored is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>500</mn><mi>M</mi><mo>×</mo><mn>5</mn><mo>×</mo><mn>12</mn><mo>=</mo><mn>30</mn><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">500M \\times 5 \\times 12 = 30B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> </li>\n<li>Total storage size is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>30</mn><mi>B</mi><mo>×</mo><mn>500</mn><mo>=</mo><mn>15</mn><mi>T</mi><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">30B \\times 500 = 15TB</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>Network Estimations:</strong></p>\n<ol>\n<li>\n<p>Do the following conversions:</p>\n<ul>\n<li>Expected read bandwidth is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>K</mi><mo>×</mo><mn>500</mn><mo>=</mo><mn>10</mn><mi>M</mi><mi>B</mi><mi mathvariant=\"normal\">/</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">20K \\times 500 = 10MB/s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">s</span></span></span></span></li>\n<li>Expected write bandwidth is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>200</mn><mo>×</mo><mn>500</mn><mo>=</mo><mn>100</mn><mi>K</mi><mi>B</mi><mi mathvariant=\"normal\">/</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">200 \\times 500 = 100KB/s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">s</span></span></span></span></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>Memory Estimations:</strong></p>\n<ol>\n<li>\n<p>Estimate expected storage variables:</p>\n<ul>\n<li>Assume <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">20 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">%</span></span></span></span> of URLs generate <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>80</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">80 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mord\">%</span></span></span></span> of traffic</li>\n<li>As a result, cache <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">20 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">%</span></span></span></span> of data</li>\n<li>Assume data should be cached for a day</li>\n<li>Most redirections use the same URL, so cache will be overestimated likely</li>\n</ul>\n</li>\n<li>\n<p>Do the following conversions:</p>\n<ul>\n<li>Reads per day is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>K</mi><mo>×</mo><mn>3600</mn><mo>×</mo><mn>24</mn><mo>=</mo><mn>1.7</mn><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">20K \\times 3600 \\times 24 = 1.7B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord\">7</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span></li>\n<li>Total cache size is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.2</mn><mo>×</mo><mn>1.7</mn><mi>B</mi><mo>×</mo><mn>500</mn><mo>=</mo><mn>170</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">0.2 \\times 1.7B \\times 500 = 170GB</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord\">7</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">7</span><span class=\"mord\">0</span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>High-Level Summary:</strong></p>\n<ul>\n<li>We'll assume there are <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>500</mn></mrow><annotation encoding=\"application/x-tex\">500</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> million new URLs per month</li>\n<li>We'll assume there are <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn></mrow><annotation encoding=\"application/x-tex\">50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span></span></span></span> billion URL redirections per month</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Category</th>\n<th>Time Estimate</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>New URL</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> URLS per second</td>\n</tr>\n<tr>\n<td>URL redirection</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn></mrow><annotation encoding=\"application/x-tex\">20</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span></span></span></span>K redirections per second</td>\n</tr>\n<tr>\n<td>Incoming data</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>100</mn></mrow><annotation encoding=\"application/x-tex\">100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> KB/s</td>\n</tr>\n<tr>\n<td>Outgoing data</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn></mrow><annotation encoding=\"application/x-tex\">10</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span> MB/s</td>\n</tr>\n<tr>\n<td>Storage for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span> years</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>15</mn></mrow><annotation encoding=\"application/x-tex\">15</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span></span></span></span> TB</td>\n</tr>\n<tr>\n<td>Memory of cache</td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>170</mn></mrow><annotation encoding=\"application/x-tex\">170</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">7</span><span class=\"mord\">0</span></span></span></span> GB</td>\n</tr>\n</tbody>\n</table>\n<h3>Step 3: System API Design</h3>\n<ul>\n<li>\n<p>Note, a malicious user may want to consume all the URL keys in the current design</p>\n<ul>\n<li>To prevent abuse, we can limit users via their api_key</li>\n<li>Specifically, certain users would be limited to a certain number of URL creations and redirections</li>\n</ul>\n</li>\n<li>The following are a few, potential API calls:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token triple-quoted-string string\">\"\"\"\nDescription\n----\nThis API call is used for creating a shortened URL.\n\n\nParameters\n----\napi_key : string\n    The API developer key for a registered account.\noriginal_url : string\n    The original URL that will be shortened.\ncustom_alias : string\n    (Optional) Any pre-determined shortened URL.\nuser_name : string\n    (Optional) Any user name used in the encoding.\nexpire_date : string\n    (Optional) Any desired data for the URL to expire on.\n\n\nReturns\n---\nA successful request returns a shortened URL;\notherwise, an error code will be returned\n\"\"\"</span>\ncreateURL<span class=\"token punctuation\">(</span>\n    api_key<span class=\"token punctuation\">,</span>\n    original_url<span class=\"token punctuation\">,</span>\n    custom_alias<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    user_name<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    expire_date<span class=\"token operator\">=</span><span class=\"token boolean\">None</span>\n    <span class=\"token punctuation\">)</span>\n\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nDescription\n----\nThis API call is used for deleting a preexisting\nshortened URL that has already been created using\nthis service.\n\n\nParameters\n----\napi_key : string\n    The API developer key for a registered account.\noriginal_url : string\n    The key of a preexisting shortened URL.\n\n\nReturns\n---\nA successful request deletes a preexisting shortened URL;\notherwise, an error code will be returned\n\"\"\"</span>\ndeleteURL<span class=\"token punctuation\">(</span>\n    api_key<span class=\"token punctuation\">,</span>\n    url_key\n    <span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Step 4: Database Design</h3>\n<ol>\n<li>\n<p>Observations about the data:</p>\n<ul>\n<li>Billions of records must be stored</li>\n<li>Each object will be small in terms of storage</li>\n<li>Records (i.e. shortened URLs) don't have have any relationship with each other</li>\n<li>Our service will handle more reads than writes</li>\n</ul>\n</li>\n<li>\n<p>Key entities of the system:</p>\n<ul>\n<li>Two tables will be needed</li>\n<li>One table will store information about each URL</li>\n<li>Another table will store information about each user</li>\n</ul>\n</li>\n<li>\n<p>Type of database:</p>\n<ul>\n<li>Billions of rows must be stored</li>\n<li>No relationships between the objects</li>\n<li>For the above reasons, a NoSQL database like DynamoDB or Cassandra would be a good choice</li>\n</ul>\n</li>\n</ol>\n<p><img src=\"/3abcfbf8cab2a2c700358d476591297e/datamodel_shorten.svg\" alt=\"highleveldesign\"></p>\n<h3>Step 5a: Summarizing the Basic System Designs</h3>\n<ul>\n<li>The goal of our system is to generate a unique and shortened key for a given URL</li>\n<li>\n<p>An example of a TinyURL shortened URL is <em><a href=\"https://tinyurl.com/rxcsyr3r\" target=\"_blank\" rel=\"nofollow\">https://tinyurl.com/rxcsyr3r</a></em></p>\n<ul>\n<li>The last <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">8</span></span></span></span> characters of this URL represents the shortened key</li>\n<li>This shortened key is what our system will generate</li>\n</ul>\n</li>\n<li>\n<p>There are two options:</p>\n<ul>\n<li>Encoding a shortened URL in real-time</li>\n<li>Generating a shortened URL offline</li>\n</ul>\n</li>\n</ul>\n<h3>Step 5b: Summarizing a Basic Real-Time Design</h3>\n<ul>\n<li>\n<p>This approach involves passing the original URL through a hash function first, then passing that hash value through an encoding function</p>\n<ul>\n<li>Potential hash functions include MD5, SHA256, and others</li>\n<li>Potential encoding functions include Base36, Base64, and others</li>\n</ul>\n</li>\n<li>The SHA256 hash function will convert the original URL to a series of 256 bits</li>\n<li>The Base64 encoding function will convert the hash value to a string of characters</li>\n<li>The reason for passing the original URL through a hash function is to produce a unique representation of the original URL</li>\n<li>The reason for passing the hash value through an encoding function is to represent the binary hash value as a string and in fewer characters</li>\n<li>\n<p><strong>Potential Problems:</strong></p>\n<ul>\n<li>If different users try to shorten the same URL, then they'd receive the same hash value outputting the same shortened URL, which is unacceptable</li>\n</ul>\n</li>\n<li>\n<p><strong>Potential Workarounds:</strong></p>\n<ul>\n<li>An incramenting URL ID can be appended to each original URL</li>\n<li>Then, the hash value will be unique once the original URL + URL ID is inputted into the hash function</li>\n<li>We don't need to store this sequence number in the database</li>\n<li>However, if this ID incraments to a huge number, there could be overload and impact the performance of the service</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/545a5066775b0c7597a83deac77a0b20/encoding_online.svg\" alt=\"encodingonline\"></p>\n<h3>Step 5c: Summarizing a Basic Offline Design</h3>\n<ul>\n<li>This approach involves using a <strong>key generation service</strong> that generates random six-letter strings beforehand</li>\n<li>Once these keys are generated, they are stored in a database so they can be requested later on</li>\n<li>\n<p><strong>Pro:</strong> this approach is much simpler since:</p>\n<ul>\n<li>Encoding original URLs isn't necessary</li>\n<li>Creating duplicate keys won't happen, since the KGS will ensure keys aren't added to the database unless they're unique</li>\n</ul>\n</li>\n<li>\n<p><strong>Pro:</strong> this approach is much faster since:</p>\n<ul>\n<li>URLs don't need to be encoded</li>\n<li>Keys are already generated</li>\n</ul>\n</li>\n<li><strong>Caveat:</strong> keys must be marked in the database after requested and used to ensure they're not used again</li>\n<li><strong>Caveat:</strong> the key DB must be about <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>412</mn></mrow><annotation encoding=\"application/x-tex\">412</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">2</span></span></span></span> GB assuming 68.7B six-character keys are generated and stored</li>\n<li>\n<p><strong>Potential Problems:</strong></p>\n<ul>\n<li>Keys that have been used should be differentiated from keys that haven't been used</li>\n<li>Two of the same keys may be retrieved by different users for concurrent requests, which is unacceptable</li>\n<li>The KGS could be a single point of failure if running on a standalone server</li>\n</ul>\n</li>\n<li>\n<p><strong>Potential Workarounds:</strong></p>\n<ul>\n<li>Keys that have been used should be removed and moved to a separate table, or a flag should be added to differentiate keys that have been used from those that haven't been used</li>\n<li>To ensure two of the same keys aren't retrieved by different users in concurrent requests, then the KGS could use a <a href=\"https://web.mit.edu/6.005/www/fa15/classes/23-locks/\" target=\"_blank\" rel=\"nofollow\">Lock</a> data structure to make sure key retrievals are synchronized before sending a key to concurrent application servers</li>\n<li>To prevent the KGS from being a single point of failure, we can run multiple replica KGS on different servers using ZooKeeper</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/7e3794bbd48a50ab44a7f900a742c51d/encoding_offline.svg\" alt=\"encodingoffline\"></p>\n<h3>Step 6a: Implementing Data Partitioning Methods</h3>\n<ul>\n<li>To handle the storage of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>15</mn></mrow><annotation encoding=\"application/x-tex\">15</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span></span></span></span> TB of data in our NoSQL database, we'll need to think about partitioning our data across multiple DB servers</li>\n<li>\n<p>There are a few applicable partitioning options:</p>\n<ul>\n<li>Range-based partitioning</li>\n<li>Hash-based partitioning</li>\n</ul>\n</li>\n<li>\n<p><strong>Range-based partitioning</strong> involves partitioning data based on a particular trait related to the input</p>\n<ul>\n<li>For example, we could partition URLs starting with the letter <em>A</em> on one server, partition URLs starting with the letter <em>B</em> on another server, etc.</li>\n<li>Alternatively, we could parition URLs accessed more frequently on one server and partition URLs accessed less frequently on another server</li>\n<li>\n<p>The disadvantage of this approach is there is a higher chance of producing unbalanced DB servers</p>\n<ul>\n<li>Meaning, we may realize not many URLs start with the letter <em>Q</em> but more URLs start with the letter <em>A</em></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Hash-based partitioning</strong> involves partitioning data based on an input's hash value</p>\n<ul>\n<li>\n<p>For example, we could input any shortened URL into a hash function mapping it to a value between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>−</mo><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">1-256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span></p>\n<ul>\n<li>Here, we could have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span> different partitions or DB servers</li>\n</ul>\n</li>\n<li>Then, we could partition the shortened URL based on its hash value</li>\n<li>There's a chance this approach can still lead to overloaded partitioning, which can be alleviated using <a href=\"https://www.dkharazi.github.io/blog/hash\" target=\"_blank\" rel=\"nofollow\">consistent hashing</a></li>\n</ul>\n</li>\n</ul>\n<h3>Step 6b: Implementing Caching Methods</h3>\n<ul>\n<li>Caching is used for quickly retrieving more frequently (or recently) requested data</li>\n<li>There are many off-the-shelf cacheing solutions that can be used, like Memcached</li>\n<li>By storing original URLs with their respective hash values in a cache, our application servers can quickly query the cache to see if the URL exists before querying the larger partitioned storage</li>\n<li>\n<p>When creating a cache store, we should think about the following questions:</p>\n<ul>\n<li>\n<p><strong>How much cache memory should be reserved?</strong></p>\n<ul>\n<li>Assuming the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>80</mn><mo>−</mo><mn>20</mn></mrow><annotation encoding=\"application/x-tex\">80-20</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span></span></span></span> rule, cacheing <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">20 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">%</span></span></span></span> should be a reasonable start</li>\n<li>Based on our estimates above, cacheing <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">20 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">%</span></span></span></span> of daily traffic will require <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>170</mn></mrow><annotation encoding=\"application/x-tex\">170</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">7</span><span class=\"mord\">0</span></span></span></span>GB of memory</li>\n<li>Since most modern-day servers support <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span>GB or memory, we could easily fit our cache on a single machine</li>\n<li>Alternatively, we could use more smaller machines to cache more traffic</li>\n</ul>\n</li>\n<li>\n<p><strong>Which cache eviction policy should be enforced?</strong></p>\n<ul>\n<li>Eviction policies refer to how we decide to replace URLs in our cache once it's full</li>\n<li>\n<p>For example, we may want to replace a URL that hasn't been accessed in our cache recently with a more recent URL</p>\n<ul>\n<li>This policy is known as the <em>Least Recenctly Used (LRU)</em> policy</li>\n</ul>\n</li>\n<li>To enforce this policy, we could create a <em>linked hash map</em> tracking recent nodes containing their original URL and their hash value (or shortened URL hash value)</li>\n</ul>\n</li>\n<li>\n<p><strong>How can each cache replica be updated?</strong></p>\n<ul>\n<li>Replicating cached data servers to other server can distribute the overall load</li>\n<li>Whenever there is a cache miss and the user must request for the URL in the larger backend database, then the URL will be added to the cache and its replicas</li>\n<li><strong>TODO -- FINISH BY ADDING IMAGE</strong></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>Step 6c: Implementing Load Balancing Methods</h3>\n<ul>\n<li>\n<p>There are <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span> places we can add a load balancer in our system:</p>\n<ol>\n<li>\n<p>Between clients and the application servers</p>\n<ul>\n<li>Handles too many users accessing system</li>\n</ul>\n</li>\n<li>\n<p>Between application servers and database servers</p>\n<ul>\n<li>Handles too many requests to a concentrated database servers</li>\n</ul>\n</li>\n<li>\n<p>Between application servers and cache servers</p>\n<ul>\n<li>Handles too many requests to a concentrated cache servers</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>Generally, a simple Round Robin approach works well for load balancing</p>\n<ul>\n<li>This approach distributes requests equally across DB servers</li>\n<li>This approach is simple to implement and doesn't introduce any overhead</li>\n<li>If a server goes down, it will be removed from the round robin process automatically</li>\n</ul>\n</li>\n<li>\n<p>Alternatively, we can intelligently query which DB servers are experiencing more load occasionally and direct traffic to DB servers in light use</p>\n<ul>\n<li>This approach controls for DB load, whereas the round robin approach doesn't</li>\n<li>As a result, the round robin approach can slow down DB servers even more if they're experiencing heavy loads at any given moment</li>\n</ul>\n</li>\n<li><strong>TODO -- ILLUSTRATE ROUND ROBIN LB TECHNIQUE</strong></li>\n</ul>\n<h3>Step 6d: Implementing Cleanup Services</h3>\n<ul>\n<li>\n<p>There are still two functions required related to data purges:</p>\n<ul>\n<li>Purging URLs after a certain time of inactivity</li>\n<li>Purging URLs where user has specified an expiration time</li>\n</ul>\n</li>\n<li>Constantly searching for expired links would put too much pressure on the database</li>\n<li>\n<p>Instead, we should implement a lazy cleanup</p>\n<ul>\n<li>For example, expired links can be deleted from the DB after a user tries accessing it</li>\n<li>\n<p>Alternatively, cleanup services can run occasionally to remove expired URLs from the database and cache</p>\n<ul>\n<li>This service should be very lightweight</li>\n<li>E.g. it can run only when user traffic is expected to be low</li>\n</ul>\n</li>\n<li>Alternatively, there can be default expiration times for each link (e.g. two years)</li>\n<li>Since storage is very cheap, we could arguably keep URLs forever</li>\n</ul>\n</li>\n<li><strong>TODO -- ILLUSTRATE DIAGRAM OF FINAL SYSTEM</strong></li>\n</ul>\n<h3>Step 6d: Storing Telemetry Data</h3>\n<ul>\n<li>User and usage statistics should be saved at different points in our system</li>\n<li>\n<p>The following are examples of data that could be stores:</p>\n<ul>\n<li>Number of times a URL is used</li>\n<li>Location of user that accesses a URL</li>\n<li>Timestamp for when URL is accessed</li>\n<li>Web page that refers the click </li>\n</ul>\n</li>\n<li>These statistics could be stored in the same row as the URL data</li>\n<li>\n<p>Alternatively, these statistics could be stored in their own separate fact tables</p>\n<ul>\n<li>This could help alleviate load on popular URLs</li>\n</ul>\n</li>\n</ul>\n<h3>Step 6e: Enforcing Security and Permissions</h3>\n<ul>\n<li>\n<p>The following are example of security questions we'd like to answer:</p>\n<ul>\n<li>Can users create private URLs?</li>\n<li>Can users allow a set of users to access a URL?</li>\n</ul>\n</li>\n<li>We can store these permissions in a separate table or with the other URL data</li>\n<li>For example, a separate table can store the URL ID, user IDs, and any permission data</li>\n<li>If a user doesn't have permission and tries to access a URL, we can return an HTTP 401 error</li>\n<li>\n<p>Given that we are storing our data in a NoSQL columnar database like Cassandra</p>\n<ul>\n<li>The primary key for the table storing permissions would be the hash value (or the KGS generated key)</li>\n<li>The columns will store the user IDs of those users with permission to see the URL</li>\n</ul>\n</li>\n</ul>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=JQDHz72OA3c&#x26;ab_channel=TechDummiesNarendraL\" target=\"_blank\" rel=\"nofollow\">Video illustrating TinyURL System Design</a></li>\n<li><a href=\"https://www.educative.io/courses/grokking-the-system-design-interview/B892KY261z2\" target=\"_blank\" rel=\"nofollow\">Grokking the System Design Interview</a></li>\n<li><a href=\"https://github.com/Jeevan-kumar-Raj/Grokking-System-Design\" target=\"_blank\" rel=\"nofollow\">Wiki for System Design</a></li>\n<li><a href=\"https://github.com/sharanyaa/grok_sdi_educative\" target=\"_blank\" rel=\"nofollow\">Another Wiki for System Design</a></li>\n<li><a href=\"https://docs.microsoft.com/en-us/common-data-model/\" target=\"_blank\" rel=\"nofollow\">Microsoft Guide of Common Data Models</a></li>\n<li><a href=\"https://crypto.stackexchange.com/a/76910\" target=\"_blank\" rel=\"nofollow\">Wiki on Importance of Encoding and Hashing</a></li>\n<li><a href=\"https://stackoverflow.com/a/9660100/12777044\" target=\"_blank\" rel=\"nofollow\">Wiki on Encoding Hashed Values</a></li>\n</ul>"}},"pageContext":{"slug":"de/system_design_problems/tinyurl","previousSlug":"de/system_design_problems/basics","nextSlug":null,"previousTitle":"System Design Basics","nextTitle":null}},"staticQueryHashes":[]}