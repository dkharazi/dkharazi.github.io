{"componentChunkName":"component---src-templates-entry-js","path":"/notes/py/gunicorn/hooks","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Server Hooks"},"html":"<h3>Describing the <code class=\"language-text\">on_starting</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">on_starting</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">on_starting</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called before the master process is initialized</li>\n<li>It needs to accept a single instance variable</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">on_reload</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">on_reload</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">on_reload</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function recycles workers during a reload</li>\n<li>It needs to accept a single instance variable </li>\n</ul>\n<h3>Describing the <code class=\"language-text\">when_ready</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">when_ready</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">when_ready</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after the server is started</li>\n<li>It needs to accept a single instance variable </li>\n</ul>\n<h3>Describing the <code class=\"language-text\">pre_fork</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">pre_fork</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">pre_fork</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called before a worker is forked</li>\n<li>It needs to accept two instance variables</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">post_fork</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">post_fork</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">post_fork</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after a worker is forked</li>\n<li>It needs to accept two instance variables</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">post_worker_init</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">post_worker_init</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">post_worker_init</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after a worker has initialized the application</li>\n<li>It needs to accept a single instance variable</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">worker_init</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">worker_init</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">worker_init</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after a worker exited</li>\n<li>It needs to accept a single instance variable for the initialized Worker</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">worker_abort</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">worker_abort</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">worker_abort</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called when a worker is aborted</li>\n<li>It needs to accept a single instance variable for the initialized Worker</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">pre_exec</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">pre_exec</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">pre_exec</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called just before a new master process is forked</li>\n<li>It needs to accept a single instance variable</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">pre_request</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">pre_request</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">pre_request</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     worker<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">.</span>debug<span class=\"token punctuation\">(</span><span class=\"token string\">\"%s %s\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>This function is called just before a worker processes the request</li>\n<li>It needs to accept a two instances that are a worker and request</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">post_request</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">post_request</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">post_request</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">,</span> environ<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after a worker processes the request</li>\n<li>It needs to accept a two instances that are a worker and request</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">child_exit</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">child_exit</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">child_exit</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called just after a worker has exited in the master process</li>\n<li>It needs to accept a two instances that are a server and worker</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">worker_exit</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">worker_exit</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">worker_exit</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after a worker has been exited in the worker process</li>\n<li>It needs to accept a two instances that are a server and worker</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">nworkers_changed</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">nworkers_changed</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">nworkers_changed</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> new_value<span class=\"token punctuation\">,</span> old_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called after <em>num_workers</em> has been changed</li>\n<li>It needs to accept a single instance</li>\n<li>\n<p>It also needs to accept two integers</p>\n<ul>\n<li>The number of workers before the change</li>\n<li>The number of workers after the change</li>\n</ul>\n</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">on_exit</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">on_exit</code></li>\n</ul>\n</li>\n<li>The setting can be defined using the function:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">on_exit</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>This function is called before exiting Gunicorn</li>\n<li>It needs to accept a single instance variable</li>\n</ul>\n<h3>Example of Server Hook</h3>\n<ul>\n<li>A <code class=\"language-text\">.py</code> server file can be defined as:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># server.py</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">def</span> <span class=\"token function\">on_starting</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     app<span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">(</span><span class=\"token string\">'Starting Server'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>A <code class=\"language-text\">.py</code> configuration file can be defined as:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># config.py</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">import</span> server\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> on_starting <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span>on_starting</code></pre></div>\n<ul>\n<li>We can specify it using the <code class=\"language-text\">-c</code> flag:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token operator\">$ </span>gunicorn -c config.py <span class=\"token punctuation\">..</span>.</code></pre></div>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://docs.gunicorn.org/en/stable/settings.html#server-hooks\" target=\"_blank\" rel=\"nofollow\">Gunicorn Documentation</a></li>\n<li><a href=\"https://github.com/benoitc/gunicorn/issues/2136#issuecomment-542907480\" target=\"_blank\" rel=\"nofollow\">How to Use Server Hooks</a></li>\n</ul>"}},"pageContext":{"slug":"py/gunicorn/hooks","previousSlug":"py/gunicorn/security","nextSlug":"py/gunicorn/mechanics","previousTitle":"Security","nextTitle":"Server Mechanics"}},"staticQueryHashes":[]}