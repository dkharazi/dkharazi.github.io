{"componentChunkName":"component---src-templates-entry-js","path":"/notes/py/gunicorn/worker","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Worker Processes"},"html":"<h3>Describing the <code class=\"language-text\">workers</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">workers</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--workers INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">1</code></li>\n<li>This setting specifies the number of worker processes for handling requests</li>\n<li>Generally, this parameter is in the range of:</li>\n</ul>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mo>×</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mi>s</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">(2 \\times numcores) + 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span>\n<ul>\n<li>Here, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> is some number between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span></span></span></span></li>\n<li>We'll want to adjust <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> to find the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> that best handles our application's work load</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">worker_class</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">worker_class</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--worker-class STRING</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">sync</code></li>\n<li>This setting specifies the types of workers</li>\n<li>\n<p>Some valid types of workers are:</p>\n<ul>\n<li><code class=\"language-text\">sync</code></li>\n<li><code class=\"language-text\">eventlet</code></li>\n<li><code class=\"language-text\">gevent</code></li>\n<li><code class=\"language-text\">tornado</code></li>\n<li><code class=\"language-text\">gthread</code></li>\n</ul>\n</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">threads</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">threads</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--threads INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">1</code></li>\n<li>This setting specifies the number of threads per worker</li>\n<li>These threads are used for handling requests</li>\n<li>This parameter only goes into effect when <code class=\"language-text\">gthread</code> is the <code class=\"language-text\">worker_class</code></li>\n</ul>\n<h3>Describing the <code class=\"language-text\">worker_connections</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">worker_connections</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--worker-connections INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">1000</code></li>\n<li>This setting specifies the maximum number of simulataneous clients</li>\n<li>This setting only affects the <code class=\"language-text\">eventlet</code> and <code class=\"language-text\">gevent</code> worker types</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">max_requests</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">max_requests</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--max-requests INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">0</code></li>\n<li>This setting specifies the number of requests that a worker will process before restarting</li>\n<li>Since the default is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>, the restarts are disabled</li>\n<li>This helps limit the damage of memory leaks</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">max_requests_jitter</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">max_requests_jitter</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--max-requests-jitter INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">0</code></li>\n<li>This setting specifies the maximum jitter to add to <code class=\"language-text\">max_requests</code></li>\n<li>The jitter causes the restart per worker to be randomized by <code class=\"language-text\">randint(0, max_requests_jitter)</code></li>\n<li>This is used to avoid workers from restarting simultaneously</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">timeout</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">timeout</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--timeout INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">30</code></li>\n<li>This setting specifies the seconds for which workers need to be silent until they are killed and restarted</li>\n<li>Generally, this is set to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>30</mn></mrow><annotation encoding=\"application/x-tex\">30</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span></span></span></span> seconds</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">graceful_timeout</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">graceful_timeout</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--graceful-timeout INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">30</code></li>\n<li>This setting specifies the timeout needed for greaceful workers to restart</li>\n<li>After receiving a restart signal, workers have this much time to finish serving requests</li>\n<li>Workers still alive after the timeout are restarted</li>\n</ul>\n<h3>Describing the <code class=\"language-text\">keepalive</code> Setting</h3>\n<ul>\n<li>\n<p>The setting in the configuration file is:</p>\n<ul>\n<li><code class=\"language-text\">keepalive</code></li>\n</ul>\n</li>\n<li>\n<p>The setting in the CLI is:</p>\n<ul>\n<li><code class=\"language-text\">--keep-alive INT</code></li>\n</ul>\n</li>\n<li>It defaults to <code class=\"language-text\">2</code></li>\n<li>This setting specifies the seconds that requests should be waited on until blocked</li>\n<li>Specifically, this refers to a keep-alive connection</li>\n<li>Generally, this is set to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>−</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">1-5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span> seconds</li>\n</ul>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://docs.gunicorn.org/en/stable/settings.html#worker-processes\" target=\"_blank\" rel=\"nofollow\">Gunicorn Documentation</a></li>\n<li><a href=\"https://stackoverflow.com/a/41696500/12777044\" target=\"_blank\" rel=\"nofollow\">Advice for Number of Workers and Threads</a></li>\n</ul>"}},"pageContext":{"slug":"py/gunicorn/worker","previousSlug":"py/gunicorn/socket","nextSlug":"py/gunicorn/instrumentation","previousTitle":"Server Socket","nextTitle":"Instrumentation"}},"staticQueryHashes":[]}